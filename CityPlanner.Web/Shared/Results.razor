@inject IJSRuntime _jsRuntime
@page "/results"

<div>
    <div class="@_firstSectionHiddenClass transform transition duration-500 mt-4">
        <div id="asd" class="flex flex-row justify-center w-full mt-2">
            <button class="text-xs text-subText bg-pageBg flex flex-row space-x-2" @onclick="() => _mainLayout.GoToIndex()">
                <img src="/icons/repeat.svg" alt="school icon" class="w-1/5">
                <div>Try again</div>
            </button>
        </div>

        <div class="title-box mt-8">
            <div class="title-subtext">
                What we&apos;ve discovered at
            </div>
            <div class="relative title-text w-max">
                <h1 class="">
                    @Building.Street @Building.OrientationNumber, @Building.District
                </h1>
            </div>
        </div>

    <div class="flex flex-col justify-center items-center space-y-2 w-3/4 mt-16 mx-auto">
        <h6 class="text-lg text-subText mb-1">What you&apos;ve got</h6>
        <div class="flex flex-row space-x-10 justify-center font-light w-full">
            <div class="flex flex-row items-stretch space-x-1 whitespace-nowrap">
                @if (ResultsDTO.ForKids)
                {
                    <Checkmark />
                }
                else
                {
                    <Cross />
                }
                <div>
                    For kids
                </div>
            </div>
            <div class="flex flex-row items-stretch space-x-1 whitespace-nowrap">
                @if (ResultsDTO.NightLife)
                {
                    <Checkmark />
                }
                else
                {
                    <Cross />
                }
                <div>
                    Night life

                </div>
            </div>
                <div class="flex flex-row items-stretch space-x-1 whitespace-nowrap">
                    @if (ResultsDTO.PetLovers)
                    {
                        <Checkmark />
                    }
                    else
                    {
                        <Cross />
                    }
                    <div>
                        Pet lovers
                    </div>
                </div>
        </div>
    </div>
    <div class="relative mt-4 flex flex-col justify-center items-center w-1/2 mx-auto ">
        <h6 class="mt-4 text-lg text-subText mb-2">Everything is within your walking distance</h6>
        <div class="relative w-3/4 mx-auto text-5xl text-slate-400">
            <button @onclick='@(() => ScrollCarousel("left"))' class="absolute top-14 left-[-2rem] cursor-pointer hover:text-main">‹</button>
            <button @onclick='@(() => ScrollCarousel("right"))' class="absolute top-14 right-[-2rem] cursor-pointer hover:text-main">›</button>
        </div>
        <div class="max-w-xl mx-auto min-w-0">
            <div class="carousel scroll-smooth overflow-x-scroll scrollbar-hide flex space-x-5 font-light">
                
                <div class="w-full flex flex-col p-2 bg-white rounded-[3px] min-w-[11rem] items-center text-sm flex-wrap break-before-auto text-center">
                    <img src="/icons/school.svg" alt="school icon" class="w-1/5">
                    <div class="mt-1 tracking-wider">School</div>
                    <div class="font-bold mt-1 leading-5">ZS Park Angelinum</div>
                    <div class="mt-1 text-xs font-semibold flex flex-row space-x-2 items-stretch">
                        <img src="/icons/time.svg" alt="time icon" class="w-1/6 self-center">
                        <div class="self-center @GetColorTime(5)">5 min</div>
                    </div>
                    <div class="text-subText text-xs mt-2">+ 4 more</div>
                </div>

                <div class="flex flex-col p-2 bg-white rounded-[3px] min-w-[11rem] items-center text-sm flex-wrap break-before-auto text-center">
                    <img src="/icons/school.svg" alt="school icon" class="w-1/5">
                    <div class="mt-1 tracking-wider">School</div>
                    <div class="font-bold mt-1 leading-5">ZS Park Angelinum</div>
                    <div class="mt-1 text-xs font-semibold flex flex-row space-x-2 items-stretch">
                        <img src="/icons/time.svg" alt="time icon" class="w-1/6 self-center">
                        <div class="self-center @GetColorTime(20)">20 min</div>
                    </div>
                    <div class="text-subText text-xs mt-2">+ 4 more</div>
                </div>

                <div class="flex flex-col p-2 bg-white rounded-[3px] min-w-[11rem] items-center text-sm flex-wrap break-before-auto text-center">
                    <img src="/icons/school.svg" alt="school icon" class="w-1/5">
                    <div class="mt-1 tracking-wider">School</div>
                    <div class="font-bold mt-1 leading-5">ZS Park Angelinum</div>
                    <div class="mt-1 text-xs font-semibold flex flex-row space-x-2 items-stretch">
                        <img src="/icons/time.svg" alt="time icon" class="w-1/6 self-center">
                        <div class="self-center @GetColorTime(5)">5 min</div>
                    </div>
                    <div class="text-subText text-xs mt-2">+ 4 more</div>
                </div>

                <div class="flex flex-col p-2 bg-white rounded-[3px] min-w-[11rem] items-center text-sm flex-wrap break-before-auto text-center">
                    <img src="/icons/school.svg" alt="school icon" class="w-1/5">
                    <div class="mt-1 tracking-wider">School</div>
                    <div class="font-bold mt-1 leading-5">ZS Park Angelinum</div>
                    <div class="mt-1 text-xs font-semibold flex flex-row space-x-2 items-stretch">
                        <img src="/icons/time.svg" alt="time icon" class="w-1/6 self-center">
                        <div class="self-center @GetColorTime(5)">5 min</div>
                    </div>
                    <div class="text-subText text-xs mt-2">+ 4 more</div>
                </div>
            </div>
        </div>
    

        <div class="w-max mx-auto">
            <Score ScoreValue="@ResultsDTO.Score"></Score>
        </div>


        <div class="flex flex-row justify-center mt-4">
            <button class="animate-bounce w-6 h-6" @onclick="Scroll">
                <img src="/icons/down-arrow.svg" alt="arrow down">
            </button>
        </div>
    </div>
    </div>
    <div class="fixed bottom-0 w-full h-screen min-h-screen transform @_secondSectionHiddenClass transition duration-500">
        <div class="flex flex-row justify-center mt-6">
            <button class="animate-bounce w-6 h-6" @onclick="Scroll">
                <img src="/icons/down-arrow.svg" alt="arrow down" class="rotate-180">
            </button>
        </div>
        <div class="bg-white w-2/3 mx-auto h-2/3 mt-6 rounded-md p-2">
            <GoogleMaps Building="Building" />
        </div>
    </div>
</div>

@code {
    
    [CascadingParameter(Name = Constants.CascadingParameters.MainLayout)]
    private MainLayout _mainLayout { get; set; } = default!;

    [Parameter]
    public ResultsDTO ResultsDTO { get; set; } = null!;

    [Parameter]
    public Building Building { get; set; } = null!;

    private bool _firstSectionHidden = false;
    private string? _firstSectionHiddenClass => _firstSectionHidden ? "-translate-y-[110vh]" : null;

    private bool _secondSectionHidden = true;
    private string? _secondSectionHiddenClass => _secondSectionHidden ? "translate-y-full" : null;

    private bool _bgWNormal = true;
    private string? _bgWNormalClass => _bgWNormal ? null : "scale-110";

    private void Scroll()
    {
        _firstSectionHidden = !_firstSectionHidden;
        _secondSectionHidden = !_secondSectionHidden;
         _bgWNormal = !_bgWNormal;
    }

    private string GetColorTime(int min)
    {
        if (min > 15)
            return "text-red-500";
        return "text-green-600";
    }

    private async Task ScrollCarousel(string direction)
    {
        Console.WriteLine(direction);
        if(direction == "left") {
            await _jsRuntime.InvokeVoidAsync("moveCarousel", direction);
        }
        else
        {
            await _jsRuntime.InvokeVoidAsync("moveCarousel", direction);
        }
    }
}